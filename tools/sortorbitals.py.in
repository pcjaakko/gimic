#!@PYTHON_EXECUTABLE@
import re, subprocess, os 

def main():

    if os.path.isfile('basis-backup'):
        print ("File 'basis-backup' already exists. Maybe the orbitals are already ordered? Nothing has been done.")
        return 0

    ecpfound = 0
    lastline = ""
    lastwords = list()
    lastwords.append("")
    lastletter = ""
    sbffer = list()
    pbffer = list()
    dbffer = list()
    fbffer = list()
    gbffer = list()
    hbffer = list()
    ibffer = list()
    bffer = list()

    with open("basis", "r") as f:
        lines = f.readlines()

    for line in lines:
        words = line.split()
        pregexp = re.compile('   [0-9]  [a-z]')
        m = pregexp.match(line)
        mlast = pregexp.match(lastline)
        qregexp = re.compile(' *[0-9]')
        n = qregexp.match(line)
        nlast = qregexp.match(lastline)


        if ecpfound == 1:
            bffer.append(line)

        elif '$ecp' in line:
            ecpfound = 1
            bffer.append(line)
        
        elif nlast and words[0]=='*':
            for line in sbffer:
                bffer.append(line)
            sbffer = list()
            for line in pbffer:
                bffer.append(line)
            pbffer = list()
            for line in dbffer:
                bffer.append(line)
            dbffer = list()
            for line in fbffer:
                bffer.append(line)
            fbffer = list()
            for line in gbffer:
                bffer.append(line)
            gbffer = list()
            for line in hbffer:
                bffer.append(line)
            hbffer = list()
            for line in ibffer:
                bffer.append(line)
            ibffer = list()
            bffer.append("*\n")

        elif m:
            lastletter=words[1]
            if lastletter=='s':
                sbffer.append(line)
            if lastletter=='p':
                pbffer.append(line)
            if lastletter=='d':
                dbffer.append(line)
            if lastletter=='f':
                fbffer.append(line)
            if lastletter=='g':
                gbffer.append(line)
            if lastletter=='h':
                hbffer.append(line)
            if lastletter=='i':
                ibffer.append(line)

        elif n:
            if lastletter=='s':
                sbffer.append(line)
            if lastletter=='p':
                pbffer.append(line)
            if lastletter=='d':
                dbffer.append(line)
            if lastletter=='f':
                fbffer.append(line)
            if lastletter=='g':
                gbffer.append(line)
            if lastletter=='h':
                hbffer.append(line)
            if lastletter=='i':
                ibffer.append(line)

        else:
            bffer.append(line)


        lastline = line
        lastwords = words


    subprocess.run(['cp','basis','basis-backup'])

    with open("basis", "w") as f:
        for line in bffer:
            f.write(line)

    return 0

if __name__ == '__main__':
    main()

